<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Irrigation Dashboard</title>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background:#f4f6f9;
}

header{
  background:linear-gradient(90deg,#2ecc71,#27ae60);
  color:white;
  padding:18px;
  text-align:center;
  font-size:22px;
  font-weight:600;
}

.status-bar{
  display:flex;
  justify-content:space-between;
  background:white;
  padding:12px 20px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
  font-size:14px;
}

.ok{color:#27ae60;font-weight:600;}
.bad{color:#e74c3c;font-weight:600;}

.container{
  max-width:1100px;
  margin:30px auto;
  padding:0 15px;
}

.card{
  background:white;
  border-radius:16px;
  padding:25px;
  box-shadow:0 10px 25px rgba(0,0,0,0.05);
  margin-bottom:25px;
}

.soil-main{
  text-align:center;
}

.soil-main h1{
  font-size:60px;
  margin:10px 0;
}

.soil-main p{
  color:#666;
  margin:0;
}

.chart-box{
  margin-top:20px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:20px;
}

.data-card{
  background:#f9fafc;
  padding:18px;
  border-radius:12px;
  text-align:center;
}

.data-card h3{
  margin-bottom:15px;
  font-size:16px;
  color:#444;
}

.value{
  font-size:20px;
  font-weight:600;
}

.status-text{
  margin-top:15px;
  font-size:16px;
}

button{
  border:none;
  padding:12px 18px;
  border-radius:8px;
  font-size:14px;
  cursor:pointer;
  margin-top:10px;
}

.btn-mode{
  background:#3498db;
  color:white;
  width:100%;
}

.btn-on{
  background:#2ecc71;
  color:white;
  width:48%;
}

.btn-off{
  background:#e74c3c;
  color:white;
  width:48%;
}

.btn-row{
  display:flex;
  justify-content:space-between;
}

footer{
  text-align:center;
  padding:15px;
  font-size:13px;
  color:#888;
}
</style>
</head>
<body>

<header>üå± Smart Irrigation Monitoring System</header>

<div class="status-bar">
  <div>MQTT: <span id="mqttStatus" class="ok">CONNECTED</span></div>
  <div>SISTEM IoT: <span id="espStatus" class="bad">OFFLINE</span></div>
  <div>Update: <span id="lastUpdate">--:--:--</span></div>
</div>

<div class="container">

  <!-- SOIL -->
  <div class="card soil-main">
    <h1><span id="soil">--</span>%</h1>
    <p>Kelembapan Tanah (Rentang 0 - 100%)</p>

    <div class="chart-box">
      <canvas id="soilChart"></canvas>
    </div>
  </div>

  <!-- BATTERY & PANEL -->
  <div class="grid">

    <div class="card">
      <h3>üîã Data Baterai</h3>
      <div class="value">Volt: <span id="battVolt">--</span> V</div>
      <div class="value">Arus: <span id="battCurr">--</span> mA</div>
      <div class="value">Daya: <span id="battPower">--</span> W</div>
    </div>

    <div class="card">
      <h3>‚òÄÔ∏è Data Panel Surya</h3>
      <div class="value">Volt: <span id="panelVolt">--</span> V</div>
      <div class="value">Arus: <span id="panelCurr">--</span> mA</div>
      <div class="value">Daya: <span id="panelPower">--</span> W</div>
    </div>

  </div>

  <!-- MODE & PUMP -->
  <div class="card">
    <div class="status-text">Mode: <b id="mode">--</b></div>
    <div class="status-text">Pompa: <b id="pompa">--</b></div>

    <button class="btn-mode" onclick="toggleMode()">GANTI MODE</button>

    <div class="btn-row">
      <button class="btn-on" onclick="setPump('ON')">POMPA ON</button>
      <button class="btn-off" onclick="setPump('OFF')">POMPA OFF</button>
    </div>
  </div>

</div>

<footer>ESP32 ‚Ä¢ HiveMQ ‚Ä¢ IoT Smart Irrigation System</footer>

<script>
const ctx = document.getElementById('soilChart').getContext('2d');

const soilChart = new Chart(ctx,{
  type:'line',
  data:{
    labels:[],
    datasets:[{
      label:'Kelembapan (%)',
      data:[],
      borderColor:'#2ecc71',
      backgroundColor:'rgba(46,204,113,0.2)',
      borderWidth:2,
      tension:0.4,
      fill:true
    }]
  },
  options:{
    responsive:true,
    scales:{
      y:{
        min:0,
        max:100,
        title:{
          display:true,
          text:'Kelembapan (%)'
        }
      },
      x:{
        title:{
          display:true,
          text:'Waktu (Jam:Menit:Detik)'
        }
      }
    }
  }
});

function addChartData(value){
  const now=new Date();
  const time=now.toLocaleTimeString();

  soilChart.data.labels.push(time);
  soilChart.data.datasets[0].data.push(value);

  if(soilChart.data.labels.length>20){
    soilChart.data.labels.shift();
    soilChart.data.datasets[0].data.shift();
  }

  soilChart.update();
  document.getElementById("lastUpdate").innerText=time;
}
</script>

<script src="script.js"></script>

</body>
</html>
